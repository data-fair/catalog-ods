{
  "$id": "https://github.com/data-fair/catalog-ods/config",
  "x-exports": [
    "types",
    "validate",
    "schema"
  ],
  "title": "ODSConfig",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "url"
  ],
  "layout": [
    "url",
    {
      "comp": "expansion-panels",
      "children": [
        {
          "title": "ODS and Data Fair themes bindings",
          "x-i18n-title": {
            "fr": "Correspondance des thèmes ODS et Data Fair"
          },
          "children": [
            {
              "markdown": "You can link one (or several) Data Fair themes to each ODS theme.",
              "x-i18n-markdown": {
                "fr": "Vous pouvez associer pour chaque <strong>thème ODS</strong> une ou plusieurs <strong>thématiques Data Fair</strong>. Ces thématiques doivent être préalablement créées sur Data Fair depuis l'onglet <a href=\"/data-fair/settings\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>Thématiques</strong></a> dans les paramètres."
              }
            },
            "themes"
          ]
        }
      ]
    }
  ],
  "properties": {
    "url": {
      "type": "string",
      "title": "URL",
      "description": "The URL of the API",
      "x-i18n-description": {
        "fr": "L'URL du site, l'API utilisée sera urlRenseignee/api/explore/v2.1"
      },
      "pattern": "^https?://.*[^/]$",
      "examples": [
        "https://data.mon-domaine.fr"
      ]
    },
    "themes": {
      "type": "array",
      "title": "",
      "layout": {
        "comp": "list",
        "listEditMode": "inline",
        "density": "compact",
        "getItems": {
          "url": {
            "expr": "parent.data.url ? `${parent.data.url}/api/explore/v2.1/catalog/facets?facet=theme` : undefined",
            "type": "js-eval"
          },
          "itemsResults": "data.facets[0]?.facets",
          "itemKey": "item.value"
        }
      },
      "items": {
        "type": "object",
        "required": [
          "value",
          "dataFairThemes"
        ],
        "properties": {
          "value": {
            "type": "string",
            "title": "ODS theme",
            "x-i18n-title": {
              "fr": "Thème ODS"
            },
            "readOnly": true,
            "layout": {
              "cols": 6
            }
          },
          "dataFairThemes": {
            "type": "array",
            "title": "Thèmes Data Fair",
            "default": [],
            "layout": {
              "props": {
                "clearable": true
              },
              "cols": 6,
              "getItems": {
                "url": "/data-fair/api/v1/settings/${context.owner.type}/${context.owner.id}/topics",
                "itemsResults": "data",
                "itemKey": "item.title",
                "itemTitle": "item.title",
                "itemIcon": "item.icon?.svg"
              }
            },
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "title"
              ],
              "properties": {
                "id": {
                  "type": "string"
                },
                "title": {
                  "type": "string"
                },
                "color": {
                  "type": "string"
                },
                "icon": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  }
}