{
  "$id": "https://github.com/data-fair/catalog-ods/ods-importSchema",
  "x-exports": [
    "types",
    "schema"
  ],
  "title": "ImportConfigSchema",
  "layout": {
    "title": null
  },
  "type": "object",
  "additionalProperties": false,
  "required": [
    "filters"
  ],
  "properties": {
    "filters": {
      "type": "array",
      "title": "Filtres de l'import",
      "default": [],
      "items": {
        "type": "object",
        "title": "Filtre",
        "properties": {
          "field": {
            "type": "object",
            "title": "Colonne de filtre",
            "properties": {
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string"
              }
            },
            "required": [
              "name",
              "type"
            ],
            "additionalProperties": true,
            "layout": {
              "getItems": {
                "url": "${context.catalogConfig.url}/api/explore/v2.1/catalog/datasets/${context.resourceId}?select=fields",
                "itemsResults": "data.fields",
                "itemTitle": "item.name",
                "itemKey": "item.name"
              }
            }
          },
          "valeurs": {
            "type": "array",
            "title": "Valeurs",
            "layout": {
              "comp": "select",
              "if": {
                "expr": "parent.data?.field?.name?.length > 0",
                "pure": false
              },
              "getItems": {
                "url": "${context.catalogConfig.url}/api/explore/v2.1/catalog/datasets/${context.resourceId}/facets?facet=${parent.data?.field?.name}",
                "itemsResults": "data.facets[0].facets",
                "itemTitle": "item.name",
                "itemKey": "item.name"
              }
            },
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                }
              },
              "required": [
                "name"
              ],
              "additionalProperties": true
            }
          }
        }
      }
    }
  }
}